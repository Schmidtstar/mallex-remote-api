# Vite & Replit – Blocked Request Fix

## Problem
Beim Starten einer Vite-App in Replit erscheint:

```
Blocked request. This host ("XYZ.riker.replit.dev") is not allowed.
To allow this host, add "XYZ.riker.replit.dev" to server.allowedHosts in vite.config.js.
```

## Ursache
- Vite blockiert standardmäßig unbekannte Hosts (Sicherheitsfeature).
- Replit nutzt dynamische Subdomains, die sich bei jedem Start ändern können.
- `vite.config.js` wird oft gar nicht geladen (falsches Format oder falscher Pfad).

---

## Lösung

### 1. Config-Datei umbenennen
Nutze **ESM-Format**:
- `vite.config.mts` (für TypeScript) **oder**
- `vite.config.mjs` (für JavaScript)

Oder in `package.json` setzen:
```json
"type": "module"
```

---

### 2. Beispiel-Config für Replit

```ts
// vite.config.mts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig(({ mode }) => {
  console.log('[vite] config geladen – mode:', mode)
  return {
    plugins: [react()],
    server: {
      host: true,              // horcht auf externe Hosts
      port: 5173,
      strictPort: false,
      allowedHosts: [
        '.replit.dev',         // Wildcard für alle Replit-Subdomains
        '.riker.replit.dev'    // falls Replit "riker" als Zwischen-Level nutzt
      ],
      hmr: {
        protocol: 'wss',       // für HTTPS-Umgebungen wie Replit
        clientPort: 443
      }
    },
    preview: {
      allowedHosts: [
        '.replit.dev',
        '.riker.replit.dev'
      ]
    }
  }
})
```

---

### 3. package.json anpassen

```json
{
  "scripts": {
    "dev": "vite --force --host"
  }
}
```

- `--host` = externer Zugriff erlaubt
- `--force` = Cache leeren, alte Host-Einträge entfernen

---

### 4. Dev-Server neu starten
- In Replit **"Stop"** drücken  
- Danach `npm run dev` ausführen  
- Prüfen, ob in der Konsole steht:
```
[vite] config geladen – mode: development
```

---

### 5. Debugging
- `npx vite --debug` → zeigt an, welche Config geladen wird
- Sicherstellen, dass URL auf `.replit.dev` endet (Wildcard deckt es ab)

---

✅ Damit sollten Blocked-Request-Fehler in Replit verschwinden.
